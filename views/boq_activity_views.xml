<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- BOQ Sub-Activity List View -->
    <record id="view_boq_subactivity_list" model="ir.ui.view">
        <field name="name">boq.subactivity.list</field>
        <field name="model">boq.subactivity</field>
        <field name="arch" type="xml">
            <list string="Sub-Activities" editable="bottom" sum="total_cumulative">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="product_id" required="1"/>
                <field name="description"/>
                <field name="activity_type"/>
                <field name="previous_qty" readonly="1"/>
                <field name="current_qty"/>
                <field name="master_qty" required="1"/>
                <field name="uom_id"/>
                <field name="product_cost"/>
                <field name="total_cost" readonly="1"/>
                <field name="margin_percent"/>
                <field name="unit_price" readonly="1"/>
                <field name="total_previous" widget="monetary" readonly="1"/>
                <field name="total_current" widget="monetary" readonly="1"/>
                <field name="total_cumulative" widget="monetary" readonly="1" sum="Total"/>
                <field name="billed_progress_percent" widget="progressbar" readonly="1"/>
                <field name="onsite_progress_percent" widget="progressbar" readonly="1"/>
                <field name="currency_id" column_invisible="1"/>
                <button name="action_view_additional_costs" 
                       string="Additional Costs" 
                       type="object" icon="fa-dollar" class="btn-link"/>
            </list>
        </field>
    </record>

    <!-- BOQ Sub-Activity Form View -->
    <record id="view_boq_subactivity_form" model="ir.ui.view">
        <field name="name">boq.subactivity.form</field>
        <field name="model">boq.subactivity</field>
        <field name="arch" type="xml">
            <form string="Sub-Activity">
                <sheet>
                    <group>
                        <group>
                            <field name="activity_id" readonly="1"/>
                            <field name="product_id" required="1"/>
                            <field name="description"/>
                            <field name="activity_type"/>
                        </group>
                        <group>
                            <field name="sequence"/>
                            <field name="uom_id"/>
                            <field name="is_variation" readonly="1"/>
                            <field name="source_variation_id" readonly="1" 
                                   invisible="not is_variation"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Quantities">
                            <group>
                                <group>
                                    <field name="master_qty" required="1"/>
                                    <field name="current_qty"/>
                                    <field name="previous_qty" readonly="1"/>
                                </group>
                                <group>
                                    <field name="billed_progress_percent" widget="progressbar"/>
                                    <field name="onsite_progress_percent" widget="progressbar"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Costing">
                            <group>
                                <group>
                                    <field name="product_cost"/>
                                    <field name="total_cost" readonly="1"/>
                                    <field name="margin_percent"/>
                                    <field name="unit_price" readonly="1"/>
                                </group>
                                <group>
                                    <field name="total_previous" widget="monetary"/>
                                    <field name="total_current" widget="monetary"/>
                                    <field name="total_cumulative" widget="monetary"/>
                                    <field name="currency_id" invisible="1"/>
                                </group>
                            </group>
                            
                            <group string="Additional Costs">
                                <field name="additional_cost_ids" nolabel="1">
                                    <list editable="bottom">
                                        <field name="name" required="1"/>
                                        <field name="cost" required="1" sum="Total"/>
                                        <field name="description"/>
                                    </list>
                                </field>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- BOQ Sub-Activity Search View -->
    <record id="view_boq_subactivity_search" model="ir.ui.view">
        <field name="name">boq.subactivity.search</field>
        <field name="model">boq.subactivity</field>
        <field name="arch" type="xml">
            <search string="Sub-Activities">
                <field name="name"/>
                <field name="product_id"/>
                <field name="activity_id"/>
                <field name="boq_id"/>
                <field name="activity_type"/>
                
                <separator/>
                <filter name="material" string="Material" 
                        domain="[('activity_type', '=', 'material')]"/>
                <filter name="labor" string="Labor" 
                        domain="[('activity_type', '=', 'labor')]"/>
                <filter name="service" string="Service" 
                        domain="[('activity_type', '=', 'service')]"/>
                
                <separator/>
                <filter name="variation" string="Variation Items" 
                        domain="[('is_variation', '=', True)]"/>
                <filter name="original" string="Original Items" 
                        domain="[('is_variation', '=', False)]"/>
                
                <group expand="0" string="Group By">
                    <filter name="group_by_activity" string="Activity" 
                            context="{'group_by': 'activity_id'}"/>
                    <filter name="group_by_product" string="Product" 
                            context="{'group_by': 'product_id'}"/>
                    <filter name="group_by_activity_type" string="Activity Type" 
                            context="{'group_by': 'activity_type'}"/>
                    <filter name="group_by_boq" string="BOQ" 
                            context="{'group_by': 'boq_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Additional Costs List View -->
    <record id="view_boq_subactivity_cost_list" model="ir.ui.view">
        <field name="name">boq.subactivity.cost.list</field>
        <field name="model">boq.subactivity.cost</field>
        <field name="arch" type="xml">
            <list string="Additional Costs" editable="bottom">
                <field name="name" required="1"/>
                <field name="cost" required="1" widget="monetary" sum="Total"/>
                <field name="description"/>
            </list>
        </field>
    </record>

    <!-- Additional Costs Form View -->
    <record id="view_boq_subactivity_cost_form" model="ir.ui.view">
        <field name="name">boq.subactivity.cost.form</field>
        <field name="model">boq.subactivity.cost</field>
        <field name="arch" type="xml">
            <form string="Additional Cost">
                <sheet>
                    <group>
                        <field name="subactivity_id" readonly="1"/>
                        <field name="name" required="1"/>
                        <field name="cost" required="1"/>
                        <field name="description"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
</odoo>